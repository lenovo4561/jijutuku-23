<template>
  <div class="page-container">
    <list class="list-view">
      <!-- 1. é¡¶éƒ¨ Header -->
      <list-item type="header" class="header-section">
        <stack class="header-stack">
          <!-- é¡¶éƒ¨èƒŒæ™¯å›¾ -->
          <image class="header-bg" src="../../assets/img/shoujibizhi-bg-1.png"></image>
        </stack>
      </list-item>

      <!-- 2. åˆ†ç±»å¯¼èˆª -->
      <list-item type="category" class="category-section">
        <list class="category-scroll" scroll-effect="no">
          <list-item type="category-item" for="{{(index, item) in categories}}">
            <div class="{{currentCat === index ? 'category-item-active' : 'category-item'}}" onclick="switchCat(index)">
              <text class="cat-icon">{{item.icon}}</text>
              <text class="{{currentCat === index ? 'cat-text-active' : 'cat-text'}}">{{item.name}}</text>
            </div>
          </list-item>
        </list>
      </list-item>

      <!-- 3. æ’è¡Œæ¦œæ ‡é¢˜æ  -->
      <list-item type="rank-bar" class="rank-bar-section">
        <div class="rank-left">
          <div class="red-line"></div>
          <text class="rank-title">çƒ­åº¦æ’è¡Œ</text>
        </div>
        <div class="rank-right">
          <text class="{{sortType === 'newest' ? 'filter-option active-filter' : 'filter-option'}}" onclick="switchSort('newest')">æœ€æ–°</text>
          <text class="{{sortType === 'hottest' ? 'filter-option active-filter' : 'filter-option'}}" onclick="switchSort('hottest')">æœ€çƒ­</text>
        </div>
      </list-item>

      <!-- 4. å£çº¸åˆ—è¡¨ (åŒåˆ—) -->
      <list-item type="wallpaper-grid" class="wallpaper-row" for="{{(rowIndex, rowItem) in wallpaperRows}}">
        <div class="wallpaper-card left-card" if="{{rowItem.left}}" onclick="openDetail(rowItem.left)">
          <image class="wallpaper-img" src="{{rowItem.left.url}}"></image>
        </div>
        <div class="wallpaper-card right-card" if="{{rowItem.right}}" onclick="openDetail(rowItem.right)">
          <image class="wallpaper-img" src="{{rowItem.right.url}}"></image>
        </div>
      </list-item>
      
      <!-- åº•éƒ¨ç•™ç™½ï¼Œé˜²æ­¢è¢« TabBar é®æŒ¡ -->
      <list-item type="footer" class="footer-spacer"></list-item>
    </list>
  </div>
</template>

<script>
import router from '@system.router'

export default {
  data: {
    currentCat: 0,
    sortType: 'newest',
    categories: [
      { icon: 'ğŸ”¥', name: 'ç²¾é€‰', folder: 'cnxh' },
      { icon: 'ğŸš—', name: 'åŠ¨æ¼«', folder: 'cnxh' },
      { icon: 'ğŸ‘«', name: 'äººç‰©', folder: 'cnxh' },
      { icon: 'ğŸ±', name: 'èŒå® ', folder: 'cnxh' },
      { icon: 'ğŸŒ²', name: 'è‡ªç„¶', folder: 'cnxh' }
    ],
    wallpaperList: [],
    wallpaperRows: []
  },
  onInit() {
    console.log('Bizhi page init')
    this.loadWallpapers()
  },
  loadWallpapers() {
    const folder = this.categories[this.currentCat].folder
    const baseUrl = `https://cdn.shijinzhuang.com/quick/lecuntk/bz/${folder}/`
    
    // ç”Ÿæˆ1-24çš„å£çº¸åˆ—è¡¨
    this.wallpaperList = []
    for (let i = 1; i <= 24; i++) {
      this.wallpaperList.push({
        id: i,
        url: `${baseUrl}${i}.jpg`
      })
    }
    
    // è½¬æ¢ä¸ºåŒåˆ—å¸ƒå±€
    this.wallpaperRows = []
    for (let i = 0; i < this.wallpaperList.length; i += 2) {
      this.wallpaperRows.push({
        left: this.wallpaperList[i],
        right: this.wallpaperList[i + 1] || null
      })
    }
  },
  switchCat(index) {
    this.currentCat = index
    console.log('åˆ‡æ¢åˆ†ç±»:', this.categories[index].name)
    this.loadWallpapers()
  },
  switchSort(type) {
    this.sortType = type
    console.log('åˆ‡æ¢æ’åº:', type)
    this.loadWallpapers()
  },
  openDetail(item) {
    router.push({
      uri: '/pkg_main/pages/Detail',
      params: {
        imageUrl: item.url,
        tag: 'å£çº¸'
      }
    })
  }
}
</script>

<style>
.page-container {
  background-color: #ffffff;
  flex-direction: column;
  width: 100%;
  height: 100%;
}

.list-view {
  width: 100%;
  height: 100%;
  flex-direction: column;
}

/* Header æ ·å¼ */
.header-section {
  width: 100%;
  height: 120px;
  flex-direction: column;
  margin-bottom: -10px;
}

.header-stack {
  width: 100%;
  height: 100%;
}

.header-bg {
  width: 100%;
  height: 100%;
  resize-mode: cover;
  object-fit: cover;
}

/* åˆ†ç±»å¯¼èˆªæ ·å¼ */
.category-section {
  width: 100%;
  height: 60px;
  flex-direction: row;
  align-items: center;
  margin-top: 5px;
}

.category-scroll {
  width: 100%;
  height: 100%;
  flex-direction: row;
  padding: 10px 12px;
}

.category-item {
  flex-direction: row;
  align-items: center;
  background-color: #f5f5f5;
  padding: 2px 5px;
  border-radius: 12px;
  height: 24px;
  margin-right: 6px;
  flex-shrink: 0;
}

.category-item-active {
  flex-direction: row;
  align-items: center;
  background-color: #ff3333;
  padding: 2px 7px;
  border-radius: 12px;
  height: 24px;
  margin-right: 4px;
  flex-shrink: 0;
}

.cat-icon {
  font-size: 10px;
  margin-right: 3px;
}

.cat-text {
  font-size: 10px;
  color: #666666;
  lines: 1;
  text-overflow: ellipsis;
}

.cat-text-active {
  font-size: 10px;
  color: #ffffff;
  font-weight: bold;
  lines: 1;
  text-overflow: ellipsis;
}

/* æ’è¡Œæ¦œæ ‡é¢˜æ æ ·å¼ */
.rank-bar-section {
  width: 100%;
  height: 40px;
  padding: 0 12px;
  flex-direction: row;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 0px;
  margin-top:-35px
}

.rank-left {
  flex-direction: row;
  align-items: center;
}

.red-line {
  width: 4px;
  height: 10px;
  background-color: #ff3333;
  margin-right: 6px;
  border-radius: 2px;
}

.rank-title {
  font-size: 10px;
  font-weight: bold;
  color: #333333;
}

.rank-right {
  flex-direction: row;
  align-items: center;
}

.filter-option {
  font-size: 9px;
  color: #999999;
  margin-left: 15px;
}

.active-filter {
  color: #ff3333;
  font-weight: bold;
}

/* å£çº¸åˆ—è¡¨æ ·å¼ */
.wallpaper-row {
  width: 100%;
  padding: 5px 12px;
  flex-direction: row;
  justify-content: space-between;
  margin-top:-5px
}

.wallpaper-card {
  width: 48%; /* ç¨å¾®å°äº 50% ç•™å‡ºé—´éš™ */
  height: 150px; /* ç«–å±å£çº¸æ¯”ä¾‹ */
  background-color: #f0f0f0;
  border-radius: 8px;
  overflow: hidden;
}

/* å·¦ä¾§å¡ç‰‡ */
.left-card {
  /* margin-right ç”± justify-content: space-between å¤„ç† */
}

/* å³ä¾§å¡ç‰‡ */
.right-card {
}

.wallpaper-img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

.img-placeholder {
  width: 100%;
  height: 100%;
  background-color: #e0e0e0;
}

/* åº•éƒ¨ç•™ç™½ */
.footer-spacer {
  height: 60px;
  width: 100%;
}
</style>
